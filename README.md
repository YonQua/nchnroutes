# nchnroutes

ä¸º BIRD è·¯ç”±å™¨ç”Ÿæˆéä¸­å›½å¤§é™†è·¯ç”±è§„åˆ™çš„ Python å·¥å…·ï¼Œå®ç° OSPF æ™ºèƒ½åˆ†æµã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½ç”Ÿæˆ** - é‡‡ç”¨å¹¶è¡Œå¤„ç†ä¸ä¼˜åŒ–çš„ç½‘æ®µåˆå¹¶ç®—æ³•ï¼Œç”Ÿæˆé€Ÿåº¦æå¿«ï¼ˆçº¦ 2-3 ç§’ï¼‰ã€‚
- âœ… **æ™ºèƒ½æ•°æ®æº** - ä½¿ç”¨ iwik.org æä¾›çš„é«˜è´¨é‡ä¸­å›½ IP æ•°æ®ï¼ˆMikroTik æ ¼å¼ï¼‰ã€‚
- âœ… **IANA ç™½åå•** - è‡ªåŠ¨åŒæ­¥ IANA IPv4 åœ°å€ç©ºé—´è¡¨ï¼Œç¡®ä¿åªè·¯ç”±åˆæ³•çš„å…¬ç½‘ IPï¼Œè‡ªåŠ¨è¿‡æ»¤ä¿ç•™åœ°å€ã€‚
- âœ… **IPv4/IPv6 åŒæ ˆ** - å®Œæ•´æ”¯æŒ IPv4 å’Œ IPv6 æ™ºèƒ½åˆ†æµã€‚
- âœ… **çµæ´»é…ç½®** - é€šè¿‡ `config.ini` ç»Ÿä¸€ç®¡ç†ä¿ç•™ç½‘æ®µã€è‡ªå®šä¹‰æ’é™¤ç½‘æ®µå’Œä¸‹ä¸€è·³æ¥å£ã€‚
- âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - æä¾› `Makefile` ä¸€é”®å®Œæˆæ•°æ®æ›´æ–°ã€è§„åˆ™ç”Ÿæˆå’Œ BIRD é‡è½½ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- Python 3.7+
- BIRD è·¯ç”±å™¨ç¯å¢ƒ (Linux)
- `make` å·¥å…·

### 2. ä¸€é”®ç”Ÿæˆä¸éƒ¨ç½²
æœ¬é¡¹ç›®è®¾è®¡ä¸ºåœ¨è·¯ç”±å™¨ä¸Šç›´æ¥è¿è¡Œã€‚ä½¿ç”¨ `Makefile` å¯ä¸€é”®å®Œæˆæ‰€æœ‰æ“ä½œï¼š

```bash
# æ‹‰å–æœ€æ–°ä»£ç  -> ä¸‹è½½æœ€æ–°æ•°æ®(IANA/iwik) -> ç”Ÿæˆè·¯ç”± -> éƒ¨ç½²åˆ°BIRD
make produce
```

### 3. æ‰‹åŠ¨è¿è¡Œ (å¼€å‘/æµ‹è¯•)
å¦‚æœæ‚¨åªæƒ³ç”Ÿæˆæ–‡ä»¶æŸ¥çœ‹ç»“æœï¼š

```bash
# 1. ä¸‹è½½å¿…è¦æ•°æ®
curl -o ipv4-address-space.csv https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.csv
curl -o cn_ipv4_list.txt https://cdn.leishao.nyc.mn/http://www.iwik.org/ipcountry/mikrotik/CN
curl -o cn_ipv6_list.txt https://cdn.leishao.nyc.mn/http://www.iwik.org/ipcountry/mikrotik_ipv6/CN

# 2. å‡†å¤‡é…ç½®æ–‡ä»¶
cp config.example.ini config.ini

# 3. è¿è¡Œç”Ÿæˆè„šæœ¬
python3 produce.py
```

## é…ç½®æ–‡ä»¶è¯´æ˜

ç¼–è¾‘ `config.ini` æ¥è‡ªå®šä¹‰é…ç½®ã€‚

### åŸºç¡€é…ç½®
```ini
[ç½‘ç»œé…ç½®]
# é»˜è®¤ä¸‹ä¸€è·³æ¥å£ï¼ˆç”Ÿæˆçš„è·¯ç”±è§„åˆ™ä¸­ via åé¢çš„å‚æ•°ï¼‰
default_next_hop = eth0
```

### ä¿ç•™ç½‘æ®µ (Private Networks)
**æ³¨æ„**ï¼šè„šæœ¬ä¼šæ ¹æ® IANA `ipv4-address-space.csv` è‡ªåŠ¨å¿½ç•¥æ ‡è®°ä¸º `RESERVED` çš„é¡¶çº§ç½‘æ®µï¼ˆå¦‚ `10.0.0.0/8`ï¼‰ã€‚è¿™æ„å‘³ç€è¿™äº›ç½‘æ®µé»˜è®¤å°±ä¸ä¼šè¢«åŒ…å«åœ¨ç”Ÿæˆçš„â€œå›½å¤–è·¯ç”±â€ä¸­ã€‚

å°½ç®¡å¦‚æ­¤ï¼Œå»ºè®®åœ¨ `config.ini` ä¸­æ˜¾å¼å®šä¹‰æ‚¨çš„å†…ç½‘éœ€æ±‚ï¼Œä»¥ä¾¿æ–‡æ¡£åŒ–å’Œé˜²æ­¢ä¸Šæ¸¸æ•°æ®å˜åŠ¨ã€‚

```ini
[ä¿ç•™ç½‘æ®µIPv4]
# RFC 1918 ç§æœ‰åœ°å€
private_a = 10.0.0.0/8
# private_b = 172.16.0.0/12      # æ ‡å‡† B ç±»ç§æœ‰åœ°å€
private_b_alt = 172.24.0.0/13    # ç¤ºä¾‹ï¼šé¿å¼€ Cloudflare/Docker å†²çªçš„è‡ªå®šä¹‰èŒƒå›´
private_c = 192.168.0.0/16

# å…¶ä»–ç‰¹æ®Šç”¨é€”åœ°å€...
```

### è‡ªå®šä¹‰æ’é™¤
å¦‚æœæ‚¨æœ‰ç‰¹å®šçš„å›½å¤– IP æƒ³èµ°ä¸»è·¯ç”±ï¼ˆç›´è¿ï¼‰ï¼Œå¯ä»¥åœ¨æ­¤æ·»åŠ ï¼š

```ini
[è‡ªå®šä¹‰æ’é™¤]
# æ ¼å¼ï¼šname = IP/CIDR
my_server = 203.0.113.10/32
ipv6_server = 2001:db8::1/128
```

## BIRD é…ç½®æŒ‡å—

ç”Ÿæˆçš„ `routes4.conf` å’Œ `routes6.conf` æ˜¯æ ‡å‡†çš„ BIRD é™æ€è·¯ç”±åè®®æ ¼å¼ã€‚

åœ¨ `/etc/bird/bird.conf` ä¸­å¼•å…¥ï¼š

```
protocol static {
    ipv4;
    include "/etc/bird/routes4.conf";
}

protocol static {
    ipv6;
    include "/etc/bird/routes6.conf";
}
```

## å·¥ä½œåŸç†

1.  **åŠ è½½å…¨é›†**ï¼š
    *   IPv4: è¯»å– `ipv4-address-space.csv`ï¼ŒåŠ è½½æ‰€æœ‰çŠ¶æ€ä¸º `ALLOCATED` çš„ /8 ç½‘æ®µã€‚
    *   IPv6: åŠ è½½å…¨çƒå•æ’­åœ°å€ `2000::/3`ã€‚
2.  **åŠ è½½æ’é™¤é¡¹**ï¼š
    *   è¯»å– `cn_ipv4_list.txt` / `cn_ipv6_list.txt` (ä¸­å›½ IP)ã€‚
    *   è¯»å– `config.ini` ä¸­çš„ä¿ç•™ç½‘æ®µå’Œè‡ªå®šä¹‰æ’é™¤é¡¹ã€‚
    *   **è‡ªåŠ¨åˆå¹¶**ï¼šä½¿ç”¨ç®—æ³•å°†ç›¸é‚»çš„æ’é™¤ç½‘æ®µåˆå¹¶ï¼Œå‡å°‘ç¢ç‰‡ã€‚
3.  **æ‰§è¡Œå‡æ³•**ï¼š
    *   ä»â€œå…¨é›†â€ä¸­å‡å»â€œæ’é™¤é¡¹â€ã€‚
    *   ä½¿ç”¨æ ‘å½¢ç»“æ„å’Œå“ˆå¸Œç´¢å¼• (IPv4) é«˜æ•ˆå¤„ç†ã€‚
4.  **ç”Ÿæˆè·¯ç”±**ï¼š
    *   å‰©ä¸‹çš„å³ä¸ºâ€œéä¸­å›½å¤§é™† IPâ€ï¼Œç”ŸæˆæŒ‡å‘ `default_next_hop` çš„è·¯ç”±è§„åˆ™ã€‚

## æ€§èƒ½è¡¨ç°

å¾—ç›Šäºç®—æ³•ä¼˜åŒ–å’Œå¹¶è¡Œå¤„ç†ï¼š
- **IPv4 è·¯ç”±**: çº¦ 1.7 ä¸‡æ¡
- **IPv6 è·¯ç”±**: çº¦ 4.3 ä¸‡æ¡
- **ç”Ÿæˆè€—æ—¶**: < 3 ç§’ (åœ¨æ™®é€š x86/ARM è®¾å¤‡ä¸Š)

## è®¸å¯è¯

MIT License
